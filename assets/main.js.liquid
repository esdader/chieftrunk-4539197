var ChiefTrunk = ChiefTrunk || {};

ChiefTrunk = {

    common: {

        init: function () {
            var self = this;

            self.miniNavBtn    = $('.mini-nav-btn');
            self.miniNav       = $('.l-mini-nav-container');
            self.followBtn     = $('.footer-nav').find('.follow');
            self.socialIcons   = $('.social-media');
            self.socialShowing = false;

            self.email_button  = $('.email_button');
            self.emailSignup   = $('.emailsignup');
            self.xLoc          = $('.go-signup').offset().left + 30;

            self.emailSignup.css('left', self.xLoc + 'px');

            // deals with form submision
          // //   var err_style = '';
          // //   var options = { errorClass: 'mce_inline_error', errorElement: 'div', errorStyle: err_style, onkeyup: function(){}, onfocusout:function(){}, onblur:function(){}  };
          // // var mce_validator = $("#mc-embedded-subscribe-form").validate(options);

          // // options = { url:'http://chieftrunk.us7.list-manage1.com/subscribe/post-json?u=b5c7d2ba7d35a0faa71a59dfd&id=45f52cea4b&c=?', type: 'GET', dataType: 'json', contentType: "application/json; charset=utf-8",
          // //               beforeSubmit: function(){
          // //                   $('#mce_tmp_error_msg').remove();
          // //                   $('.datefield','#mc_embed_signup').each(
          // //                       function(){
          // //                           var txt = 'filled';
          // //                           var fields = new Array();
          // //                           var i = 0;
          // //                           $(':text', this).each(
          // //                               function(){
          // //                                   fields[i] = this;
          // //                                   i++;
          // //                               });
          // //                           $(':hidden', this).each(
          // //                               function(){
          // //                                   if ( fields[0].value=='MM' && fields[1].value=='DD' && fields[2].value=='YYYY' ){
          // //                                       this.value = '';
          // //                                   } else if ( fields[0].value=='' && fields[1].value=='' && fields[2].value=='' ){
          // //                                       this.value = '';
          // //                                   } else {
          // //                                       this.value = fields[0].value+'/'+fields[1].value+'/'+fields[2].value;
          // //                                   }
          // //                               });
          // //                       });
          // //                   return mce_validator.form();
          // //               }, 
          // //               success: mce_success_cb
          // //           };
          // $('#mc-embedded-subscribe-form').ajaxForm(options);

            self.vents();

        },

        mce_success_cb: function (resp){
            if (resp.result=="success"){
                $('#mc-embedded-subscribe').hide();
                $('#mce-error-response').hide();
                $('.email_thanks').show();
            } else {
                $('#mc-embedded-subscribe').hide();
                $('#mce-error-response').show();
                $('.email_thanks').hide();
            }
        },

        vents: function () {
            var self = this;

            // track clisks on email button
            self.email_button.on('click', function(e) {
                e.preventDefault();
                self.emailSignup.toggle();
            });

            // track clicks on follow button
            self.followBtn.on('click', function(e) {
                e.preventDefault();
                if (self.socialShowing === false) {
                    self.socialIcons.hide(function(){
                        self.socialIcons.fadeIn();
                        self.socialShowing = true;
                    });
                } else {
                    self.socialIcons.fadeOut();
                    self.socialShowing = false;
                }
                
            });

            // track click on min nav button
            self.miniNavBtn.on('click', function(e) {
                e.preventDefault();
                self.miniNav.addClass('is-open');
                self.trackOutsideClick();
            });
        },

        trackOutsideClick: function() {
            var self = this;

            $('html').on('click', function(e){
                self.miniNav.removeClass('is-open');
                $('html').off('click');
            });

            self.miniNavBtn.on('click', function(e){
                e.stopPropagation();
            });
        }

    },

    giantImage: {
        init: function (config) {
            var self = this;

            // check if should track custom controls
            if ( typeof(config) !== 'undefined') {

                if ( typeof(config.customControls) !== 'undefined') {
                    
                    self.customControls = config.customControls;

                    self.nextBtns = $('.slider-next-btn');
                    self.prevBtns = $('.slider-prev-btn');
                    self.flex     = $('.flexslider');
                }

                if ( typeof(config.shortenTop) !== 'undefined') {
                    self.shortenTop = config.shortenTop;
                }

                
            }

            self.photoRatio  = 2000 / 1011;
            self.sideCrop    = 0;
            self.imageWidth  = 0;
            self.slideImage  = $('.slide-image');
            self.slideHolder = $('.slide-holder');

            if (!Modernizr.touch) {
                self.scaleLayout();
            } else {
                self.scaleSlides();
            }

            self.vents();
        },

        findLayout: function() {
            var self = this;

            self.winHeight = $(window).height();
            self.winWidth  = $(window).width();
            self.aspectRatio = self.winWidth / self.winHeight;
        },

        vents: function () {
            var self = this;

            $(window).resize(function(){
                
                if (!Modernizr.touch) {
                    self.scaleLayout();
                } else {
                    self.scaleSlides();
                }
            });

            if (self.customControls === true ) {
                self.nextBtns.on('click', function(e) {
                    e.preventDefault();
                    self.flex.flexslider('next');
                });

                self.prevBtns.on('click', function(e) {
                    e.preventDefault();
                    self.flex.flexslider('previous');
                });
            }
        },

        scaleLayout: function () {
            var self = this,
                topOffset = 0,
                activeSlide = $('.flex-active-slide');

            self.findLayout();
            
            if (self.aspectRatio > self.photoRatio) {
               
                if ( self.shortenTop === true) {
                    topOffset = 1011 / 2000 * self.winWidth - self.winHeight;

                    if (topOffset < 0) {
                        topOffset = 0;
                    }
                }

                self.slideImage.css({
                    'margin-left' : '0',
                    'margin-top' : '-' + topOffset + 'px',
                    'width' : self.winWidth+'px',
                    'height' : 'auto'
                });

                
                



            } else {
                self.sideCrop = (self.winHeight *  self.photoRatio - self.winWidth) / 2;
                self.imageWidth = self.winHeight * self.photoRatio;
                var marginLeft = '-' + self.sideCrop + 'px';
                self.slideImage.css({
                    'margin-left' : '-'+self.sideCrop+'px',
                    'width' : self.imageWidth+'px',
                    'height' : self.winHeight+'px'
                });

            }
        },

        scaleSlides: function () {
            var self = this,
                topOffset = 0;
            self.findLayout();

            if (self.aspectRatio > self.photoRatio) {

                if ( self.shortenTop === true) {
                    topOffset = 1011 / 2000 * self.winWidth - self.winHeight;

                    if (topOffset < 0) {
                        topOffset = 0;
                    }
                }
               
               self.slideImage.css({
                    'margin-left' : '0',
                    'width' : self.winWidth+'px',
                    'height' : 'auto',
                    'margin-top' : '-' + topOffset + 'px'
                });
            } else {
                self.sideCrop = (self.winHeight * self.photoRatio - self.winWidth) / 2;
                self.imageWidth = self.winHeight * self.photoRatio;
                self.slideImage.css({
                    'margin-left' : '-'+self.sideCrop+'px',
                    'width' : self.imageWidth+'px',
                    'height' : self.winHeight+'px'
                });
            }

        }
    },

    product: {

        init: function () {
            var self = this;

            self.$window             = $(window);
            self.productInfo         = $('.product-info');
            self.productInfoWidth    = self.productInfo.width();
            self.productInfoHeight   = self.productInfo.height();
            self.productImages       = $('.product-images');
            self.imageLinks          = self.productImages.find('.thmb-links');
            self.thumbs              = self.productImages.find('img');
            self.productImagesWidth  = self.productImages.width();
            self.productImagesHeight = self.productImages.height();
            self.winHeight           = $.waypoints('viewportHeight');
            self.winWidth            = $(window).width();
            self.mainImage           = $('.featured-img');
            self.tip                 = $('.tool-tip');
            self.close_btn           = $('.close-btn');
            self.giantImageHolder    = $('.giant-image-holder');
            self.giantImage          = self.giantImageHolder.find('img');
            self.invisibles          = $('.invisible');
            self.tallestCol          = 0;
            self.availableWidth      = 0;
            self.availableHeight     = 0;
            self.colMargin           = 0;

            // kick off funtions
            self.initializeProductPage();
            self.vents();

        },

        vents: function () {
            var self = this;

            // $(window).on('resize', function(e) {
            //     self.initializeProductPage();
            // });

            self.imageLinks.on('click', function(e){
                e.preventDefault();
                var $this    = $(this),
                    earl     = $this.attr('href'),
                    theAlt   = $this.attr('alt'),
                    theGiant = $this.data('giant-image');
                
                self.mainImage
                    .fadeOut(function(){
                        self.mainImage.attr({'src': earl, 'alt': theAlt})
                            .data('giant-image', theGiant)
                            .fadeIn();
                    });
                    
            });


            //Tooltips
            self.mainImage.hover(function(){
                self.tip.show(); //Show tooltip
            }, function() {
                self.tip.hide(); //Hide tooltip
            })
            .mousemove(function(e) {
                //Change these numbers to move the tooltip offset
                var mousex = e.pageX + 16; //Get X coodrinates
                var mousey = e.pageY + 16 - 107; //Get Y coordinates. 
                var tipWidth = self.tip.width(); //Find width of tooltip
                var tipHeight = self.tip.height(); //Find height of tooltip
                
                //Distance of element from the right edge of viewport
                var tipVisX = $(window).width() - (mousex + tipWidth);
                //Distance of element from the bottom of viewport
                var tipVisY = $(window).height() - (mousey + tipHeight);
                if (tipVisX < 20) { //If tooltip exceeds the X coordinate of viewport
                    mousex = e.pageX - tipWidth - 20;
                } if (tipVisY < 20) { //If tooltip exceeds the Y coordinate of viewport
                    mousey = e.pageY - tipHeight - 20 - 107;
                }
                //Absolute position the tooltip according to mouse position
                self.tip.css({  top: mousey, left: mousex });
            })
            .on('click', function(e){
                e.preventDefault();

                var $this = $(this),
                    earl  = self.mainImage.data('giant-image');

                self.giantImage.attr('src', earl);
                self.giantImageHolder.fadeIn();
            });

            self.giantImageHolder.hover(function(){
                self.close_btn.show(); //Show tooltip
            }, function() {
                self.close_btn.hide(); //Hide tooltip
            })
            .mousemove(function(e) {
                //Change these numbers to move the tooltip offset
                var mousex = e.pageX + 16; //Get X coodrinates
                var mousey = e.pageY + 16; //Get Y coordinates. 
                var tipWidth = self.close_btn.width(); //Find width of tooltip
                var tipHeight = self.close_btn.height(); //Find height of tooltip
                
                //Distance of element from the right edge of viewport
                var tipVisX = $(window).width() - (mousex + tipWidth);
                //Distance of element from the bottom of viewport
                var tipVisY = $(window).height() - (mousey + tipHeight);
                if (tipVisX < 20) { //If tooltip exceeds the X coordinate of viewport
                    mousex = e.pageX - tipWidth - 20;
                } if (tipVisY < 20) { //If tooltip exceeds the Y coordinate of viewport
                    mousey = e.pageY - tipHeight - 20;
                }
                //Absolute position the tooltip according to mouse position
                self.close_btn.css({  top: mousey, left: mousex });
            })
            .on('click', function(e){
                e.preventDefault();

                var $this = $(this);
                $this.fadeOut();
            });

        },

        initializeProductPage: function () {


            var self = this;

            self.winHeight = $.waypoints('viewportHeight');
            self.winWidth  = $(window).width();

            self.availableHeight = self.winHeight - 170;
            self.availableWidth  = self.winWidth - self.productInfoWidth - self.productImagesWidth;

            // set image height or width
            if (self.availableHeight > self.availableWidth) {
                self.mainImage.css({'max-width': self.availableWidth, 'height': 'auto'});
            } else {
                var mLeft = self.availableHeight / 2;
                self.mainImage.css({
                        'max-height': self.availableHeight,
                        'width': 'auto',
                        'position': 'absolute',
                        'left': '50%',
                        'margin-left': -self.availableHeight / 2
                        
                        });
                self.colMargin = (self.availableWidth - self.availableHeight) / 4;
                self.productInfo.css('margin-left', self.colMargin);
                self.productImages.css('margin-right', self.colMargin);

            }

            // center columns within page

            if (self.productInfoHeight > self.productImagesHeight) {
                self.productImages.css('height', self.productInfoHeight);
                var topMargin = (self.availableHeight - self.productInfoHeight) / 2;
                self.productImages.css('margin-top', topMargin);
                self.productInfo.css('margin-top', topMargin);
                var $thumbs = $(self.thumbs);
                var thmbMargin = (self.productInfoHeight - $thumbs.length * 70) / 2;
                
                $(self.thumbs[0]).css('margin-top', thmbMargin);

            }

            self.displayItems();

        },

        displayItems: function() {
            var self = this;

            self.invisibles
                .hide(function() {
                    $(this)
                        .removeClass('invisible')
                        .fadeIn();
                });
        }

    },

    shopLanding: {

    },

    products: {
        init: function() {
            var self = this;

            self.headerHeight      = $('.main-header').height();
            self.productsLanding   = $('.products-landing');
            self.lastSectionHeight = self.productsLanding.find('section').last().height();

            // set bottom padding
            //self.setBottomPadding();
        },
        setBottomPadding: function() {
            var self      = this,
                winHeight = $(window).height(),
                bottomPadding;

            bottomPadding = winHeight - self.headerHeight - self.lastSectionHeight;
            self.productsLanding.css('padding-bottom', bottomPadding);
        }
    },

    adminPages: {
        init: function () {
            var self = this;

            self.modalArticle       = $('.callout-article');
            self.modalArticleHeight = self.modalArticle.height();
            self.initialModalHeight = self.modalArticleHeight;
            self.scrollContent      = $('.scroll-content');
            self.modalHeaderHeight  = $('.callout-header').outerHeight();
            self.modalBody          = $('.callout-body');
            self.win                = $(window);
            self.modalFooterHeight  = $('.callout-footer').outerHeight();
            self.mainHeaderHeight   = $('.main-nav').outerHeight();
            self.mainFooterHeight   = $('.main-footer').outerHeight();

            self.checkHeights();
            self.vents();
        },

        vents: function() {
            var self = this;


            self.win.on('resize', function() {
                self.winHeight = self.win.height();
                self.curAvailable = self.winHeight - self.mainHeaderHeight - self.mainFooterHeight - 40;

                if (self.initialModalHeight > self.curAvailable) {
                    self.setBodyHeight();
                    
                } else {
                    self.modalBody.css('height', 'auto');
                    self.positionFauxModal();
                }
            });
        },

        checkHeights: function() {
            var self = this;

            self.winHeight = self.win.height();
            self.curAvailable = self.winHeight - self.mainHeaderHeight - self.mainFooterHeight - 40;

            if ( self.curAvailable > self.modalArticleHeight) {
                self.positionFauxModal();
            } else {
                self.setBodyHeight();
                self.modalBody.mCustomScrollbar({
                    theme:"dark",
                    autoDraggerLength: false
                });
            }

        },

        setBodyHeight: function() {
            var self = this;

            self.modalBodyHeight = self.curAvailable - self.modalHeaderHeight - self.modalFooterHeight;
            
            if (self.modalBodyHeight < 120) {
                self.modalBodyHeight = 120;
            }

            self.modalBody.css('height', self.modalBodyHeight + 'px');
            self.modalArticleHeight = self.modalArticle.height();
            
            self.modalArticle.fadeIn();
        },

        positionFauxModal: function() {
            var self = this,
                mTop = (self.curAvailable - self.modalArticleHeight) / 2;

            self.modalArticle.addClass('not-scrollable');
            self.modalArticle.css('margin-top', mTop + 'px');
            self.modalArticle.fadeIn();
        }
    },

    care: {
        init: function() {
            var self = this;
            
            self.careGuide       = $('.care-guide');
            self.careGuideHeight = self.careGuide.height();
            self.headerHeight    = $('.main-header').outerHeight();
            self.footerHeight    = $('.main-footer').height();
            self.win             = $(window);
            self.visible         = false;
            self.positionGuide();
            self.vents();
        },

        positionGuide: function() {
            var self = this,
                availableMargin = self.win.height() - self.headerHeight - self.footerHeight - self.careGuideHeight;

            if (availableMargin > 0) {
                var mTop = availableMargin / 2;

                self.careGuide.css('margin-top', mTop + 'px');

                if (self.visible === false) {
                    self.careGuide.fadeIn();
                    self.visible = true;
                }

            } else {
                
                if (self.visible === false) {
                    self.careGuide.fadeIn();
                    self.visible = true;
                }
            }
        },

        vents: function() {
            var self = this;

            self.win.on('resize', function(){
                self.positionGuide();
            });
        }
    }
};